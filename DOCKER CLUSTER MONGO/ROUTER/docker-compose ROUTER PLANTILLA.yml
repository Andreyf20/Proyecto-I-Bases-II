version: "3.0"

volumes:
  mongo-keys:
  mongo-config-0:

services:
  mongo-keys:
    image: depop/openssl-bats
    volumes:
      - mongo-keys:/mongo-conf
    command: 'bash -c "echo bWVjYWdvZW5sb25uaXM= > /mongo-conf/mongodb-keyfile; chmod 600 /mongo-conf/mongodb-keyfile; chown 999 /mongo-conf/mongodb-keyfile"'

  # Router 1
  router1:
    image: mongo
    volumes:
      - mongo-keys:/opt/keyfile
      - mongo-config-0:/data/db
    env_file: ./mongod.env
    ports:
      - [IP DE HAMACHI]:27025:27025
    command: "mongos --transitionToAuth --keyFile /opt/keyfile/mongodb-keyfile --bind_ip_all --port 27025 --configdb ReplicaConfig/25.92.183.245:27024,25.97.193.57:27024,25.108.214.3:27024"
    depends_on:
      - mongo-keys
